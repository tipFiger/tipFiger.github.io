
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_Hans">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>日志 &#8212; Django 2.1.8.dev20190330215650 文档</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="分页" href="pagination.html" />
    <link rel="prev" title="Time zones" href="i18n/timezones.html" />



 
<script type="text/javascript" src="../templatebuiltins.js"></script>
<script type="text/javascript">
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 2.1.8.dev20190330215650 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="i18n/timezones.html" title="Time zones">previous</a>
     |
    <a href="index.html" title="Using Django" accesskey="U">up</a>
   |
    <a href="pagination.html" title="分页">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="topics-logging">
            
  <div class="section" id="s-module-django.utils.log">
<span id="s-logging"></span><span id="module-django.utils.log"></span><span id="logging"></span><h1>日志<a class="headerlink" href="#module-django.utils.log" title="永久链接至标题">¶</a></h1>
<div class="section" id="s-a-quick-logging-primer">
<span id="a-quick-logging-primer"></span><h2>日志管理快速入门<a class="headerlink" href="#a-quick-logging-primer" title="永久链接至标题">¶</a></h2>
<p>Django 使用 Python 内置的 <a class="reference external" href="https://docs.python.org/3/library/logging.html#module-logging" title="(在 Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> 模块处理系统日志。关于该模块的使用，Python 自己的文档里有更详细的探讨。不过，如果你从来没用过 Python 的 logging 框架（或者即便你用过），这里是一篇快速的入门讲解。</p>
<div class="section" id="s-the-cast-of-players">
<span id="the-cast-of-players"></span><h3>日志框架的组成元素<a class="headerlink" href="#the-cast-of-players" title="永久链接至标题">¶</a></h3>
<p>一份 Python logging 配置有下面四个部分组成：</p>
<ul class="simple">
<li><a class="reference internal" href="#topic-logging-parts-loggers"><span class="std std-ref">Loggers</span></a></li>
<li><a class="reference internal" href="#topic-logging-parts-handlers"><span class="std std-ref">Handlers</span></a></li>
<li><a class="reference internal" href="#topic-logging-parts-filters"><span class="std std-ref">过滤器</span></a></li>
<li><a class="reference internal" href="#topic-logging-parts-formatters"><span class="std std-ref">Formatters</span></a></li>
</ul>
<div class="section" id="s-loggers">
<span id="s-topic-logging-parts-loggers"></span><span id="loggers"></span><span id="topic-logging-parts-loggers"></span><h4>Loggers<a class="headerlink" href="#loggers" title="永久链接至标题">¶</a></h4>
<p>logger 是日志系统的入口。每个 logger 都是命名了的 bucket， 消息写入 bucket 以便进一步处理。</p>
<p>logger 可以配置 <em>日志级别</em>。日志级别描述了由该 logger 处理的消息的严重性。Python 定义了下面几种日志级别：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>：排查故障时使用的低级别系统信息</li>
<li><code class="docutils literal notranslate"><span class="pre">INFO</span></code>：一般的系统信息</li>
<li><code class="docutils literal notranslate"><span class="pre">WARNING</span></code>：描述系统发生了一些小问题的信息</li>
<li><code class="docutils literal notranslate"><span class="pre">ERROR</span></code>：描述系统发生了大问题的信息</li>
<li><code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code>：描述系统发生严重问题的信息</li>
</ul>
<p>每一条写入 logger 的消息都是一条*日志记录*。每一条日志记录也包含*日志级别*，代表对应消息的严重程度。日志记录还包含有用的元数据，来描述被记录了日志的事件细节，例如堆栈跟踪或者错误码。</p>
<p>当 logger 处理一条消息时，会将自己的日志级别和这条消息的日志级别做对比。如果消息的日志级别匹配或者高于 logger 的日志级别，它就会被进一步处理。否则这条消息就会被忽略掉。</p>
<p>当 logger 确定了一条消息需要处理之后，会把它传给 <em>Handler</em>。</p>
</div>
<div class="section" id="s-handlers">
<span id="s-topic-logging-parts-handlers"></span><span id="handlers"></span><span id="topic-logging-parts-handlers"></span><h4>Handlers<a class="headerlink" href="#handlers" title="永久链接至标题">¶</a></h4>
<p>Handler 是决定如何处理 logger 中每一条消息的引擎。它描述特定的日志行为，比如把消息输出到屏幕、文件或网络 socket。</p>
<p>和 logger 一样，handler 也有日志级别的概念。如果一条日志记录的级别不匹配或者低于 handler 的日志级别，对应的消息会被 handler 忽略。</p>
<p>一个 logger 可以有多个 handler，每一个 handler 可以有不同的日志级别。这样就可以根据消息的重要性不同，来提供不同格式的输出。例如，你可以添加一个 handler 把  <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> 和 <code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code>&nbsp;消息发到寻呼机，再添加另一个 handler 把所有的消息（包括 <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> 和 <code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code> 消息）保存到文件里以便日后分析。</p>
</div>
<div class="section" id="s-filters">
<span id="s-topic-logging-parts-filters"></span><span id="filters"></span><span id="topic-logging-parts-filters"></span><h4>过滤器<a class="headerlink" href="#filters" title="永久链接至标题">¶</a></h4>
<p>在日志记录从 logger 传到 handler 的过程中，使用 Filter 来做额外的控制。</p>
<p>默认情况下，只要级别匹配，任何日志消息都会被处理。不过，也可以通过添加 filter 来给日志处理的过程增加额外条件。例如，可以添加一个 filter 只允许某个特定来源的 <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> 消息输出。</p>
<p>Filter 还被用来在日志输出之前对日志记录做修改。例如，可以写一个 filter，当满足一定条件时，把日志记录从 <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> 降到 <code class="docutils literal notranslate"><span class="pre">WARNING</span></code> 级别。</p>
<p>Filter 在 logger 和 handler 中都可以添加；多个 filter 可以链接起来使用，来做多重过滤操作。</p>
</div>
<div class="section" id="s-formatters">
<span id="s-topic-logging-parts-formatters"></span><span id="formatters"></span><span id="topic-logging-parts-formatters"></span><h4>Formatters<a class="headerlink" href="#formatters" title="永久链接至标题">¶</a></h4>
<p>日志记录最终是需要以文本来呈现的。Formatter 描述了文本的格式。一个 formatter 通常由包含 :ref:<a href="#id1"><span class="problematic" id="id2">`</span></a>LogRecord attributes <a href="#id3"><span class="problematic" id="id4">`</span></a>&lt;python:logrecord-attributes&gt; 的 Python 格式化字符串组成，不过你也可以为特定的格式来配置自定义的 formatter。</p>
</div>
</div>
</div>
<div class="section" id="s-using-logging">
<span id="using-logging"></span><h2>使用 logging 模块<a class="headerlink" href="#using-logging" title="永久链接至标题">¶</a></h2>
<p>配置好了 logger，handler，filter 和 formatter 之后，需要在代码里发起 logging 的调用。使用 logging 框架非常简单，下面是个例子：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the logging library</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># Get an instance of a logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">if</span> <span class="n">bad_mojo</span><span class="p">:</span>
        <span class="c1"># Log an error message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>就这么简单！<code class="docutils literal notranslate"><span class="pre">bad_mojo</span></code> 条件每次满足都会写一条 error 日志。</p>
<div class="section" id="s-naming-loggers">
<span id="naming-loggers"></span><h3>为 logger 命名<a class="headerlink" href="#naming-loggers" title="永久链接至标题">¶</a></h3>
<p>对 <a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.getLogger" title="(在 Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">logging.getLogger()</span></code></a> 的调用会获取（必要时会创建）一个 logger 的实例。不同的 logger 实例用名字来区分。这个名字是为了在配置的时候指定 logger。</p>
<p>按照惯例，logger 的名字通常是包含该 logger 的 Python 模块名，即  <code class="docutils literal notranslate"><span class="pre">__name__</span></code>。这样可以基于模块来过滤和处理日志请求。不过，如果你有其他的方式来组织你的日志消息，可以为 logger 提供点号分割的名字来标识它：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get an instance of a specific named logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;project.interesting.stuff&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>这种 logger 的名字，用点号分隔的路径定义了一种层次结构。<code class="docutils literal notranslate"><span class="pre">project.interesting</span></code> 这个 logger 是 <code class="docutils literal notranslate"><span class="pre">project.interesting.stuff</span></code> logger 的上级；而 <code class="docutils literal notranslate"><span class="pre">project</span></code> logger 是 <code class="docutils literal notranslate"><span class="pre">project.interesting</span></code> logger 的上级。</p>
<p>为什么这种层级结构是重要的呢？因为 logger 可以设置为将日志的请求*传播*给上级。这样就可以在 logger 树结构的顶层定义一组单独的 handler，来捕获所有下层的日志请求。在 <code class="docutils literal notranslate"><span class="pre">project</span></code> 命名空间中定义的 logger handler 将会捕获 <code class="docutils literal notranslate"><span class="pre">project.interesting</span></code> 和 <code class="docutils literal notranslate"><span class="pre">project.interesting.stuff</span></code> 这两个 logger 中的所有日志请求。</p>
<p>可以基于 logger 来控制传播的行为。 如果你不希望某个 logger 传播给上级，可以关闭它。</p>
</div>
<div class="section" id="s-making-logging-calls">
<span id="making-logging-calls"></span><h3>发起 logging 调用<a class="headerlink" href="#making-logging-calls" title="永久链接至标题">¶</a></h3>
<p>logger 实例包含了每种默认日志级别的入口方法：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">logger.debug()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">logger.info()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">logger.warning()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">logger.error()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">logger.critical()</span></code></li>
</ul>
<p>还有两种其他的调用方法：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">logger.log()</span></code>：手动输出一条指定日志级别的日志消息。</li>
<li><code class="docutils literal notranslate"><span class="pre">logger.exception()</span></code>：创建一个包含当前异常堆栈帧的 <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> 级别日志消息。</li>
</ul>
</div>
</div>
<div class="section" id="s-configuring-logging">
<span id="s-id1"></span><span id="configuring-logging"></span><span id="id1"></span><h2>日志模块的配置<a class="headerlink" href="#configuring-logging" title="永久链接至标题">¶</a></h2>
<p>当然，仅仅在代码里调用 logging 是不够的。还需要配置 logger、handler、filter 和 formatter 来确保日志框架能有效地输出日志。</p>
<p>Python 的日志库提供了一些配置方法，可以使用编程接口或者配置文件。Django默认使用 <a class="reference external" href="https://docs.python.org/3/library/logging.config.html#logging-config-dictschema" title="(在 Python v3.7)"><span class="xref std std-ref">dictConfig format</span></a>。</p>
<p>为了配置 logging ，用字典的格式定义一个 <a class="reference internal" href="../ref/settings.html#std:setting-LOGGING"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGGING</span></code></a> 配置项，这些配置描述了你想要的 logger、handler、filter 和 formatter，以及它们的日志级别和其他你想要的属性。</p>
<p>默认情况下 <a class="reference internal" href="../ref/settings.html#std:setting-LOGGING"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGGING</span></code></a> 配置和 <a class="reference internal" href="#default-logging-configuration"><span class="std std-ref">Django's default logging configuration</span></a>  按照下面的方式合并在一起：</p>
<p>如果 <a class="reference internal" href="../ref/settings.html#std:setting-LOGGING"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGGING</span></code></a> 这个配置项中的 <code class="docutils literal notranslate"><span class="pre">disable_existing_loggers</span></code>  被设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> （默认就是 Ture），那么默认配置中的 logger 全部被禁用。被禁用的 logger 并不是被删除了，它们仍然存在，只是静默地丢弃所有发来的日志请求，甚至不会传播给上级 logger。所以你要谨慎使用 <code class="docutils literal notranslate"><span class="pre">'disable_existing_loggers':</span> <span class="pre">True</span></code>；这很可能不是你想要的。相反你应该把 <code class="docutils literal notranslate"><span class="pre">disable_existing_loggers</span></code>&nbsp;设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，然后再重新定义其中的一些默认 loggers，或者你也可以将  <a class="reference internal" href="../ref/settings.html#std:setting-LOGGING_CONFIG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGGING_CONFIG</span></code></a> 设置为 <code class="docutils literal notranslate"><span class="pre">None</span></code> 然后 <a class="reference internal" href="#disabling-logging-configuration"><span class="std std-ref">handle logging config yourself</span></a>。</p>
<p>logging 被配置成了 Django  <code class="docutils literal notranslate"><span class="pre">setup()</span></code> 函数的一部分。因此，你可以确定的是，logger 一直都可以在项目代码里使用。</p>
<div class="section" id="s-examples">
<span id="examples"></span><h3>示例<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h3>
<p>The full documentation for <a class="reference external" href="https://docs.python.org/3/library/logging.config.html#logging-config-dictschema" title="(在 Python v3.7)"><span class="xref std std-ref">dictConfig format</span></a>
is the best source of information about logging configuration dictionaries.
However, to give you a taste of what is possible, here are several examples.</p>
<p>First, here's a simple configuration which writes all logging from the
<a class="reference internal" href="#django-logger"><span class="std std-ref">django</span></a> logger to a local file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.FileHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;/path/to/django/debug.log&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;django&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you use this example, be sure to change the <code class="docutils literal notranslate"><span class="pre">'filename'</span></code> path to a
location that's writable by the user that's running the Django application.</p>
<p>Second, here's an example of how to make the logging system print Django's
logging to the console. It may be useful during local development.</p>
<p>By default, this config only sends messages of level <code class="docutils literal notranslate"><span class="pre">INFO</span></code> or higher to the
console (same as Django's default logging config, except that the default only
displays log records when <code class="docutils literal notranslate"><span class="pre">DEBUG=True</span></code>). Django does not log many such
messages. With this config, however, you can also set the environment variable
<code class="docutils literal notranslate"><span class="pre">DJANGO_LOG_LEVEL=DEBUG</span></code> to see all of Django's debug logging which is very
verbose as it includes all database queries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;console&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.StreamHandler&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;django&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DJANGO_LOG_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, here's an example of a fairly complex logging setup:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{levelname}</span><span class="s1"> </span><span class="si">{asctime}</span><span class="s1"> </span><span class="si">{module}</span><span class="s1"> </span><span class="si">{process:d}</span><span class="s1"> </span><span class="si">{thread:d}</span><span class="s1"> </span><span class="si">{message}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="s1">&#39;{&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;simple&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{levelname}</span><span class="s1"> </span><span class="si">{message}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="s1">&#39;{&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;special&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;()&#39;</span><span class="p">:</span> <span class="s1">&#39;project.logging.SpecialFilter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;require_debug_true&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;()&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.RequireDebugTrue&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;console&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;require_debug_true&#39;</span><span class="p">],</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.StreamHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;formatter&#39;</span><span class="p">:</span> <span class="s1">&#39;simple&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.AdminEmailHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;special&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;django&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">],</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;django.request&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mail_admins&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;myproject.custom&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">,</span> <span class="s1">&#39;mail_admins&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;special&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This logging configuration does the following things:</p>
<ul>
<li><p class="first">Identifies the configuration as being in 'dictConfig version 1'
format. At present, this is the only dictConfig format version.</p>
</li>
<li><p class="first">Defines two formatters:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">simple</span></code>, that just outputs the log level name (e.g.,
<code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>) and the log message.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">format</span></code> string is a normal Python formatting string
describing the details that are to be output on each logging
line. The full list of detail that can be output can be
found in <a class="reference external" href="https://docs.python.org/3/library/logging.html#formatter-objects" title="(在 Python v3.7)"><span>Formatter Objects</span></a>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">verbose</span></code>, that outputs the log level name, the log
message, plus the time, process, thread and module that
generate the log message.</p>
</li>
</ul>
</li>
<li><p class="first">Defines two filters:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">project.logging.SpecialFilter</span></code>, using the alias <code class="docutils literal notranslate"><span class="pre">special</span></code>. If this
filter required additional arguments, they can be provided as additional
keys in the filter configuration dictionary. In this case, the argument
<code class="docutils literal notranslate"><span class="pre">foo</span></code> will be given a value of <code class="docutils literal notranslate"><span class="pre">bar</span></code> when instantiating
<code class="docutils literal notranslate"><span class="pre">SpecialFilter</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.log.RequireDebugTrue</span></code>, which passes on records when
<a class="reference internal" href="../ref/settings.html#std:setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
</ul>
</li>
<li><p class="first">Defines two handlers:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">console</span></code>, a <a class="reference external" href="https://docs.python.org/3/library/logging.handlers.html#logging.StreamHandler" title="(在 Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamHandler</span></code></a>, which prints any <code class="docutils literal notranslate"><span class="pre">INFO</span></code>
(or higher) message to <code class="docutils literal notranslate"><span class="pre">sys.stderr</span></code>. This handler uses the <code class="docutils literal notranslate"><span class="pre">simple</span></code>
output format.</li>
<li><code class="docutils literal notranslate"><span class="pre">mail_admins</span></code>, an <a class="reference internal" href="#django.utils.log.AdminEmailHandler" title="django.utils.log.AdminEmailHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdminEmailHandler</span></code></a>, which emails any <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>
(or higher) message to the site <a class="reference internal" href="../ref/settings.html#std:setting-ADMINS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ADMINS</span></code></a>. This handler uses the
<code class="docutils literal notranslate"><span class="pre">special</span></code> filter.</li>
</ul>
</li>
<li><p class="first">Configures three loggers:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django</span></code>, which passes all messages to the <code class="docutils literal notranslate"><span class="pre">console</span></code> handler.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.request</span></code>, which passes all <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> messages to
the <code class="docutils literal notranslate"><span class="pre">mail_admins</span></code> handler. In addition, this logger is
marked to <em>not</em> propagate messages. This means that log
messages written to <code class="docutils literal notranslate"><span class="pre">django.request</span></code> will not be handled
by the <code class="docutils literal notranslate"><span class="pre">django</span></code> logger.</li>
<li><code class="docutils literal notranslate"><span class="pre">myproject.custom</span></code>, which passes all messages at <code class="docutils literal notranslate"><span class="pre">INFO</span></code>
or higher that also pass the <code class="docutils literal notranslate"><span class="pre">special</span></code> filter to two
handlers -- the <code class="docutils literal notranslate"><span class="pre">console</span></code>, and <code class="docutils literal notranslate"><span class="pre">mail_admins</span></code>. This
means that all <code class="docutils literal notranslate"><span class="pre">INFO</span></code> level messages (or higher) will be
printed to the console; <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> and <code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code>
messages will also be output via email.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="s-custom-logging-configuration">
<span id="custom-logging-configuration"></span><h3>Custom logging configuration<a class="headerlink" href="#custom-logging-configuration" title="永久链接至标题">¶</a></h3>
<p>If you don't want to use Python's dictConfig format to configure your
logger, you can specify your own configuration scheme.</p>
<p>The <a class="reference internal" href="../ref/settings.html#std:setting-LOGGING_CONFIG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGGING_CONFIG</span></code></a> setting defines the callable that will
be used to configure Django's loggers. By default, it points at
Python's <a class="reference external" href="https://docs.python.org/3/library/logging.config.html#logging.config.dictConfig" title="(在 Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">logging.config.dictConfig()</span></code></a> function. However, if you want to
use a different configuration process, you can use any other callable
that takes a single argument. The contents of <a class="reference internal" href="../ref/settings.html#std:setting-LOGGING"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGGING</span></code></a> will
be provided as the value of that argument when logging is configured.</p>
</div>
<div class="section" id="s-disabling-logging-configuration">
<span id="s-id2"></span><span id="disabling-logging-configuration"></span><span id="id2"></span><h3>Disabling logging configuration<a class="headerlink" href="#disabling-logging-configuration" title="永久链接至标题">¶</a></h3>
<p>If you don't want to configure logging at all (or you want to manually
configure logging using your own approach), you can set
<a class="reference internal" href="../ref/settings.html#std:setting-LOGGING_CONFIG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGGING_CONFIG</span></code></a> to <code class="docutils literal notranslate"><span class="pre">None</span></code>. This will disable the
configuration process for <a class="reference internal" href="#default-logging-configuration"><span class="std std-ref">Django's default logging</span></a>. Here's an example that disables Django's
logging configuration and then manually configures logging:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">settings.py</span><a class="headerlink" href="#id6" title="永久链接至代码">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LOGGING_CONFIG</span> <span class="o">=</span> <span class="bp">None</span>

<span class="kn">import</span> <span class="nn">logging.config</span>
<span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Setting <a class="reference internal" href="../ref/settings.html#std:setting-LOGGING_CONFIG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGGING_CONFIG</span></code></a> to <code class="docutils literal notranslate"><span class="pre">None</span></code> only means that the automatic
configuration process is disabled, not logging itself. If you disable the
configuration process, Django will still make logging calls, falling back to
whatever default logging behavior is defined.</p>
</div>
</div>
<div class="section" id="s-django-s-logging-extensions">
<span id="django-s-logging-extensions"></span><h2>Django's logging extensions<a class="headerlink" href="#django-s-logging-extensions" title="永久链接至标题">¶</a></h2>
<p>Django provides a number of utilities to handle the unique
requirements of logging in Web server environment.</p>
<div class="section" id="s-id3">
<span id="id3"></span><h3>Loggers<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>Django provides several built-in loggers.</p>
<div class="section" id="s-django">
<span id="s-django-logger"></span><span id="django"></span><span id="django-logger"></span><h4><code class="docutils literal notranslate"><span class="pre">django</span></code><a class="headerlink" href="#django" title="永久链接至标题">¶</a></h4>
<p>The catch-all logger for messages in the  <code class="docutils literal notranslate"><span class="pre">django</span></code> hierarchy. No messages are
posted using this name but instead using one of the loggers below.</p>
</div>
<div class="section" id="s-django-request">
<span id="s-django-request-logger"></span><span id="django-request"></span><span id="django-request-logger"></span><h4><code class="docutils literal notranslate"><span class="pre">django.request</span></code><a class="headerlink" href="#django-request" title="永久链接至标题">¶</a></h4>
<p>Log messages related to the handling of requests. 5XX responses are
raised as <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> messages; 4XX responses are raised as <code class="docutils literal notranslate"><span class="pre">WARNING</span></code>
messages. Requests that are logged to the <code class="docutils literal notranslate"><span class="pre">django.security</span></code> logger aren't
logged to <code class="docutils literal notranslate"><span class="pre">django.request</span></code>.</p>
<p>Messages to this logger have the following extra context:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">status_code</span></code>: The HTTP response code associated with the
request.</li>
<li><code class="docutils literal notranslate"><span class="pre">request</span></code>: The request object that generated the logging
message.</li>
</ul>
</div>
<div class="section" id="s-django-server">
<span id="s-django-server-logger"></span><span id="django-server"></span><span id="django-server-logger"></span><h4><code class="docutils literal notranslate"><span class="pre">django.server</span></code><a class="headerlink" href="#django-server" title="永久链接至标题">¶</a></h4>
<p>Log messages related to the handling of requests received by the server invoked
by the <a class="reference internal" href="../ref/django-admin.html#django-admin-runserver"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">runserver</span></code></a> command. HTTP 5XX responses are logged as <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>
messages, 4XX responses are logged as <code class="docutils literal notranslate"><span class="pre">WARNING</span></code> messages, and everything else
is logged as <code class="docutils literal notranslate"><span class="pre">INFO</span></code>.</p>
<p>Messages to this logger have the following extra context:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">status_code</span></code>: The HTTP response code associated with the request.</li>
<li><code class="docutils literal notranslate"><span class="pre">request</span></code>: The request object that generated the logging message.</li>
</ul>
</div>
<div class="section" id="s-django-template">
<span id="s-django-template-logger"></span><span id="django-template"></span><span id="django-template-logger"></span><h4><code class="docutils literal notranslate"><span class="pre">django.template</span></code><a class="headerlink" href="#django-template" title="永久链接至标题">¶</a></h4>
<p>Log messages related to the rendering of templates.</p>
<ul class="simple">
<li>Missing context variables are logged as <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> messages.</li>
</ul>
</div>
<div class="section" id="s-django-db-backends">
<span id="s-django-db-logger"></span><span id="django-db-backends"></span><span id="django-db-logger"></span><h4><code class="docutils literal notranslate"><span class="pre">django.db.backends</span></code><a class="headerlink" href="#django-db-backends" title="永久链接至标题">¶</a></h4>
<p>Messages relating to the interaction of code with the database. For example,
every application-level SQL statement executed by a request is logged at the
<code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> level to this logger.</p>
<p>Messages to this logger have the following extra context:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">duration</span></code>: The time taken to execute the SQL statement.</li>
<li><code class="docutils literal notranslate"><span class="pre">sql</span></code>: The SQL statement that was executed.</li>
<li><code class="docutils literal notranslate"><span class="pre">params</span></code>: The parameters that were used in the SQL call.</li>
</ul>
<p>For performance reasons, SQL logging is only enabled when
<code class="docutils literal notranslate"><span class="pre">settings.DEBUG</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, regardless of the logging
level or handlers that are installed.</p>
<p>This logging does not include framework-level initialization (e.g.
<code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">TIMEZONE</span></code>) or transaction management queries (e.g. <code class="docutils literal notranslate"><span class="pre">BEGIN</span></code>,
<code class="docutils literal notranslate"><span class="pre">COMMIT</span></code>, and <code class="docutils literal notranslate"><span class="pre">ROLLBACK</span></code>). Turn on query logging in your database if you
wish to view all database queries.</p>
</div>
<div class="section" id="s-django-security">
<span id="s-django-security-logger"></span><span id="django-security"></span><span id="django-security-logger"></span><h4><code class="docutils literal notranslate"><span class="pre">django.security.*</span></code><a class="headerlink" href="#django-security" title="永久链接至标题">¶</a></h4>
<p>The security loggers will receive messages on any occurrence of
<a class="reference internal" href="../ref/exceptions.html#django.core.exceptions.SuspiciousOperation" title="django.core.exceptions.SuspiciousOperation"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SuspiciousOperation</span></code></a> and other security-related
errors. There is a sub-logger for each subtype of security error, including all
<code class="docutils literal notranslate"><span class="pre">SuspiciousOperation</span></code>s. The level of the log event depends on where the
exception is handled.  Most occurrences are logged as a warning, while
any <code class="docutils literal notranslate"><span class="pre">SuspiciousOperation</span></code> that reaches the WSGI handler will be logged as an
error. For example, when an HTTP <code class="docutils literal notranslate"><span class="pre">Host</span></code> header is included in a request from
a client that does not match <a class="reference internal" href="../ref/settings.html#std:setting-ALLOWED_HOSTS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ALLOWED_HOSTS</span></code></a>, Django will return a 400
response, and an error message will be logged to the
<code class="docutils literal notranslate"><span class="pre">django.security.DisallowedHost</span></code> logger.</p>
<p>These log events will reach the <code class="docutils literal notranslate"><span class="pre">django</span></code> logger by default, which mails error
events to admins when <code class="docutils literal notranslate"><span class="pre">DEBUG=False</span></code>. Requests resulting in a 400 response due
to a <code class="docutils literal notranslate"><span class="pre">SuspiciousOperation</span></code> will not be logged to the <code class="docutils literal notranslate"><span class="pre">django.request</span></code>
logger, but only to the <code class="docutils literal notranslate"><span class="pre">django.security</span></code> logger.</p>
<p>To silence a particular type of <code class="docutils literal notranslate"><span class="pre">SuspiciousOperation</span></code>, you can override that
specific logger following this example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;null&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.NullHandler&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">},</span>
<span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;django.security.DisallowedHost&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;null&#39;</span><span class="p">],</span>
        <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">},</span>
</pre></div>
</div>
<p>Other <code class="docutils literal notranslate"><span class="pre">django.security</span></code> loggers not based on <code class="docutils literal notranslate"><span class="pre">SuspiciousOperation</span></code> are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.security.csrf</span></code>: For <a class="reference internal" href="../ref/csrf.html#csrf-rejected-requests"><span class="std std-ref">CSRF failures</span></a>.</li>
</ul>
</div>
<div class="section" id="s-django-db-backends-schema">
<span id="django-db-backends-schema"></span><h4><code class="docutils literal notranslate"><span class="pre">django.db.backends.schema</span></code><a class="headerlink" href="#django-db-backends-schema" title="永久链接至标题">¶</a></h4>
<p>Logs the SQL queries that are executed during schema changes to the database by
the <a class="reference internal" href="migrations.html"><span class="doc">migrations framework</span></a>. Note that it won't log the
queries executed by <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RunPython" title="django.db.migrations.operations.RunPython"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunPython</span></code></a>.
Messages to this logger have <code class="docutils literal notranslate"><span class="pre">params</span></code> and <code class="docutils literal notranslate"><span class="pre">sql</span></code> in their extra context (but
unlike <code class="docutils literal notranslate"><span class="pre">django.db.backends</span></code>, not duration). The values have the same meaning
as explained in <a class="reference internal" href="#django-db-logger"><span class="std std-ref">django.db.backends</span></a>.</p>
</div>
</div>
<div class="section" id="s-id4">
<span id="id4"></span><h3>Handlers<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>Django provides one log handler in addition to those provided by the
Python logging module.</p>
<dl class="class">
<dt id="django.utils.log.AdminEmailHandler">
<em class="property">class </em><code class="descname">AdminEmailHandler</code>(<em>include_html=False</em>, <em>email_backend=None</em>)<a class="reference internal" href="../_modules/django/utils/log.html#AdminEmailHandler"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#django.utils.log.AdminEmailHandler" title="永久链接至目标">¶</a></dt>
<dd><p>This handler sends an email to the site <a class="reference internal" href="../ref/settings.html#std:setting-ADMINS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ADMINS</span></code></a> for each log
message it receives.</p>
<p>If the log record contains a <code class="docutils literal notranslate"><span class="pre">request</span></code> attribute, the full details
of the request will be included in the email. The email subject will
include the phrase &quot;internal IP&quot; if the client's IP address is in the
<a class="reference internal" href="../ref/settings.html#std:setting-INTERNAL_IPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INTERNAL_IPS</span></code></a> setting; if not, it will include &quot;EXTERNAL IP&quot;.</p>
<p>If the log record contains stack trace information, that stack
trace will be included in the email.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">include_html</span></code> argument of <code class="docutils literal notranslate"><span class="pre">AdminEmailHandler</span></code> is used to
control whether the traceback email includes an HTML attachment
containing the full content of the debug Web page that would have been
produced if <a class="reference internal" href="../ref/settings.html#std:setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> were <code class="docutils literal notranslate"><span class="pre">True</span></code>. To set this value in your
configuration, include it in the handler definition for
<code class="docutils literal notranslate"><span class="pre">django.utils.log.AdminEmailHandler</span></code>, like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.AdminEmailHandler&#39;</span><span class="p">,</span>
        <span class="s1">&#39;include_html&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
<p>Note that this HTML version of the email contains a full traceback,
with names and values of local variables at each level of the stack, plus
the values of your Django settings. This information is potentially very
sensitive, and you may not want to send it over email. Consider using
something such as <a class="reference external" href="https://pypi.org/project/sentry/">Sentry</a> to get the best of both worlds -- the
rich information of full tracebacks plus the security of <em>not</em> sending the
information over email. You may also explicitly designate certain
sensitive information to be filtered out of error reports -- learn more on
<a class="reference internal" href="../howto/error-reporting.html#filtering-error-reports"><span class="std std-ref">Filtering error reports</span></a>.</p>
<p>By setting the <code class="docutils literal notranslate"><span class="pre">email_backend</span></code> argument of <code class="docutils literal notranslate"><span class="pre">AdminEmailHandler</span></code>, the
<a class="reference internal" href="email.html#topic-email-backends"><span class="std std-ref">email backend</span></a> that is being used by the
handler can be overridden, like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.AdminEmailHandler&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email_backend&#39;</span><span class="p">:</span> <span class="s1">&#39;django.core.mail.backends.filebased.EmailBackend&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
<p>By default, an instance of the email backend specified in
<a class="reference internal" href="../ref/settings.html#std:setting-EMAIL_BACKEND"><code class="xref std std-setting docutils literal notranslate"><span class="pre">EMAIL_BACKEND</span></code></a> will be used.</p>
<dl class="method">
<dt id="django.utils.log.AdminEmailHandler.send_mail">
<code class="descname">send_mail</code>(<em>subject</em>, <em>message</em>, <em>*args</em>, <em>**kwargs</em>)<a class="reference internal" href="../_modules/django/utils/log.html#AdminEmailHandler.send_mail"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#django.utils.log.AdminEmailHandler.send_mail" title="永久链接至目标">¶</a></dt>
<dd><p>Sends emails to admin users. To customize this behavior, you can
subclass the <a class="reference internal" href="#django.utils.log.AdminEmailHandler" title="django.utils.log.AdminEmailHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdminEmailHandler</span></code></a> class and
override this method.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="s-id5">
<span id="id5"></span><h3>过滤器<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>Django provides some log filters in addition to those provided by the Python
logging module.</p>
<dl class="class">
<dt id="django.utils.log.CallbackFilter">
<em class="property">class </em><code class="descname">CallbackFilter</code>(<em>callback</em>)<a class="reference internal" href="../_modules/django/utils/log.html#CallbackFilter"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#django.utils.log.CallbackFilter" title="永久链接至目标">¶</a></dt>
<dd><p>This filter accepts a callback function (which should accept a single
argument, the record to be logged), and calls it for each record that
passes through the filter. Handling of that record will not proceed if the
callback returns False.</p>
<p>For instance, to filter out <a class="reference internal" href="../ref/exceptions.html#django.http.UnreadablePostError" title="django.http.UnreadablePostError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UnreadablePostError</span></code></a>
(raised when a user cancels an upload) from the admin emails, you would
create a filter function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">UnreadablePostError</span>

<span class="k">def</span> <span class="nf">skip_unreadable_post</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">exc_info</span><span class="p">:</span>
        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc_value</span><span class="p">,</span> <span class="n">UnreadablePostError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>and then add it to your logging config:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;skip_unreadable_posts&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;()&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.CallbackFilter&#39;</span><span class="p">,</span>
        <span class="s1">&#39;callback&#39;</span><span class="p">:</span> <span class="n">skip_unreadable_post</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;skip_unreadable_posts&#39;</span><span class="p">],</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.AdminEmailHandler&#39;</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="django.utils.log.RequireDebugFalse">
<em class="property">class </em><code class="descname">RequireDebugFalse</code><a class="reference internal" href="../_modules/django/utils/log.html#RequireDebugFalse"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#django.utils.log.RequireDebugFalse" title="永久链接至目标">¶</a></dt>
<dd><p>This filter will only pass on records when settings.DEBUG is False.</p>
<p>This filter is used as follows in the default <a class="reference internal" href="../ref/settings.html#std:setting-LOGGING"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGGING</span></code></a>
configuration to ensure that the <a class="reference internal" href="#django.utils.log.AdminEmailHandler" title="django.utils.log.AdminEmailHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdminEmailHandler</span></code></a> only sends
error emails to admins when <a class="reference internal" href="../ref/settings.html#std:setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> is <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;require_debug_false&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;()&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.RequireDebugFalse&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;require_debug_false&#39;</span><span class="p">],</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.AdminEmailHandler&#39;</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="django.utils.log.RequireDebugTrue">
<em class="property">class </em><code class="descname">RequireDebugTrue</code><a class="reference internal" href="../_modules/django/utils/log.html#RequireDebugTrue"><span class="viewcode-link">[源代码]</span></a><a class="headerlink" href="#django.utils.log.RequireDebugTrue" title="永久链接至目标">¶</a></dt>
<dd><p>This filter is similar to <a class="reference internal" href="#django.utils.log.RequireDebugFalse" title="django.utils.log.RequireDebugFalse"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequireDebugFalse</span></code></a>, except that records are
passed only when <a class="reference internal" href="../ref/settings.html#std:setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="s-django-s-default-logging-configuration">
<span id="s-default-logging-configuration"></span><span id="django-s-default-logging-configuration"></span><span id="default-logging-configuration"></span><h2>Django's default logging configuration<a class="headerlink" href="#django-s-default-logging-configuration" title="永久链接至标题">¶</a></h2>
<p>By default, Django configures the following logging:</p>
<p>When <a class="reference internal" href="../ref/settings.html#std:setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> is <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">django</span></code> logger sends messages in the <code class="docutils literal notranslate"><span class="pre">django</span></code> hierarchy (except
<code class="docutils literal notranslate"><span class="pre">django.server</span></code>) at the <code class="docutils literal notranslate"><span class="pre">INFO</span></code> level or higher to the console.</li>
</ul>
<p>When <a class="reference internal" href="../ref/settings.html#std:setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> is <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">django</span></code> logger sends messages in the <code class="docutils literal notranslate"><span class="pre">django</span></code> hierarchy (except
<code class="docutils literal notranslate"><span class="pre">django.server</span></code>)  with <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> or <code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code> level to
<a class="reference internal" href="#django.utils.log.AdminEmailHandler" title="django.utils.log.AdminEmailHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdminEmailHandler</span></code></a>.</li>
</ul>
<p>Independent of the value of <a class="reference internal" href="../ref/settings.html#std:setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a>:</p>
<ul class="simple">
<li>The <a class="reference internal" href="#django-server-logger"><span class="std std-ref">django.server</span></a> logger sends messages at the <code class="docutils literal notranslate"><span class="pre">INFO</span></code> level
or higher to the console.</li>
</ul>
<p>All loggers except <a class="reference internal" href="#django-server-logger"><span class="std std-ref">django.server</span></a> propagate logging to their
parents, up to the root <code class="docutils literal notranslate"><span class="pre">django</span></code> logger. The <code class="docutils literal notranslate"><span class="pre">console</span></code> and <code class="docutils literal notranslate"><span class="pre">mail_admins</span></code>
handlers are attached to the root logger to provide the behavior described
above.</p>
<p>See also <a class="reference internal" href="#configuring-logging"><span class="std std-ref">Configuring logging</span></a> to learn how you can
complement or replace this default logging configuration.</p>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">日志</a><ul>
<li><a class="reference internal" href="#a-quick-logging-primer">日志管理快速入门</a><ul>
<li><a class="reference internal" href="#the-cast-of-players">日志框架的组成元素</a><ul>
<li><a class="reference internal" href="#loggers">Loggers</a></li>
<li><a class="reference internal" href="#handlers">Handlers</a></li>
<li><a class="reference internal" href="#filters">过滤器</a></li>
<li><a class="reference internal" href="#formatters">Formatters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#using-logging">使用 logging 模块</a><ul>
<li><a class="reference internal" href="#naming-loggers">为 logger 命名</a></li>
<li><a class="reference internal" href="#making-logging-calls">发起 logging 调用</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-logging">日志模块的配置</a><ul>
<li><a class="reference internal" href="#examples">示例</a></li>
<li><a class="reference internal" href="#custom-logging-configuration">Custom logging configuration</a></li>
<li><a class="reference internal" href="#disabling-logging-configuration">Disabling logging configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#django-s-logging-extensions">Django's logging extensions</a><ul>
<li><a class="reference internal" href="#id3">Loggers</a><ul>
<li><a class="reference internal" href="#django"><code class="docutils literal notranslate"><span class="pre">django</span></code></a></li>
<li><a class="reference internal" href="#django-request"><code class="docutils literal notranslate"><span class="pre">django.request</span></code></a></li>
<li><a class="reference internal" href="#django-server"><code class="docutils literal notranslate"><span class="pre">django.server</span></code></a></li>
<li><a class="reference internal" href="#django-template"><code class="docutils literal notranslate"><span class="pre">django.template</span></code></a></li>
<li><a class="reference internal" href="#django-db-backends"><code class="docutils literal notranslate"><span class="pre">django.db.backends</span></code></a></li>
<li><a class="reference internal" href="#django-security"><code class="docutils literal notranslate"><span class="pre">django.security.*</span></code></a></li>
<li><a class="reference internal" href="#django-db-backends-schema"><code class="docutils literal notranslate"><span class="pre">django.db.backends.schema</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">Handlers</a></li>
<li><a class="reference internal" href="#id5">过滤器</a></li>
</ul>
</li>
<li><a class="reference internal" href="#django-s-default-logging-configuration">Django's default logging configuration</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="i18n/timezones.html"
                        title="上一章">Time zones</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="pagination.html"
                        title="下一章">分页</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/topics/logging.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="转向" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">3月 30, 2019</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="i18n/timezones.html" title="Time zones">previous</a>
     |
    <a href="index.html" title="Using Django" accesskey="U">up</a>
   |
    <a href="pagination.html" title="分页">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>